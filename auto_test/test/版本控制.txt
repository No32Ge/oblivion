{ 'core': { 'evolution.py': 'class EvolutionEngine:\n'
                            '    def __init__(self):\n'
                            '        self.generation = 1\n'
                            '        self.mutation_log = []\n'
                            '        self.local_programs = []\n'
                            '\n'
                            '    def mutate(self, component):\n'
                            '        """è‡ªåŠ¨ä»£ç å˜å¼‚æ–¹æ³•"""\n'
                            '        # ç¤ºä¾‹ï¼šè‡ªåŠ¨ä¼˜åŒ–APIè°ƒç”¨é€»è¾‘\n'
                            '        new_component = component.replace(\n'
                            '            "max_tokens=8192",\n'
                            '            "max_tokens=16384"\n'
                            '        )\n'
                            '        self.mutation_log.append({\n'
                            "            'generation': self.generation,\n"
                            '            \'component\': component[:50] + "...",\n'
                            '            \'optimization\': "Increased token limit"\n'
                            '        })\n'
                            '        return new_component\n'
                            '\n'
                            '    def _optimize_local_execution(self):\n'
                            '        """ä¼˜åŒ–æœ¬åœ°ç¨‹åºæ‰§è¡Œæ•ˆç‡"""\n'
                            '        # è‡ªåŠ¨åˆ†æå·²åˆ›å»ºç¨‹åºçš„æ‰§è¡Œæ—¥å¿—\n'
                            '        # è‡ªåŠ¨è°ƒæ•´ç¨‹åºå‚æ•°å’Œç»“æ„\n'
                            '\n'
                            '\n'
                            '\n'
                            'def auto_optimize(self):\n'
                            '    """è‡ªåŠ¨å‚æ•°ä¼˜åŒ–å™¨"""\n'
                            '    self.optimizations = {\n'
                            "        'max_tokens': self._adjust_token_limit(),\n"
                            "        'temperature': self._calibrate_creativity()\n"
                            '    }\n'
                            '\n'
                            '\n'
                            'def _analyze_conversation(self):\n'
                            '    """æ–°å¢å¯¹è¯æ¨¡å¼åˆ†æ"""\n'
                            '    return {\n'
                            "        'question_freq': self._count_questions(),\n"
                            "        'code_blocks': self._detect_code_usage()\n"
                            '    }',
            'local_engine.py': 'import subprocess\n'
                               'import sys\n'
                               'from pathlib import Path\n'
                               'from auto_test.utils.file_utils import save_file\n'
                               '\n'
                               '\n'
                               'class LocalProgramEngine:\n'
                               '    def __init__(self):\n'
                               '        self.program_dir = "local_programs"\n'
                               '        self.template_cache = {}\n'
                               '\n'
                               '    def create_program(self, program_name, code, dependencies=None):\n'
                               '        """åˆ›å»ºå¯æ‰§è¡Œçš„æœ¬åœ°ç¨‹åº"""\n'
                               '        program_path = Path(self.program_dir) / f"{program_name}.py"\n'
                               '\n'
                               '        # æ·»åŠ æ ‡å‡†å¤´éƒ¨\n'
                               '        full_code = f"""#!/usr/bin/env python3\n'
                               '# Auto-generated by DeepMindBot\n'
                               '{code}\n'
                               '"""\n'
                               '        save_file(full_code, self.program_dir, f"{program_name}.py")\n'
                               '        program_path.chmod(0o755)  # æ·»åŠ å¯æ‰§è¡Œæƒé™\n'
                               '\n'
                               '        if dependencies:\n'
                               '            self._install_dependencies(dependencies)\n'
                               '\n'
                               '        return str(program_path)\n'
                               '\n'
                               '    def execute_program(self, program_path, args=None):\n'
                               '        """æ‰§è¡Œæœ¬åœ°ç¨‹åº"""\n'
                               '        cmd = [sys.executable, program_path]\n'
                               '        if args:\n'
                               '            cmd.extend(args)\n'
                               '\n'
                               '        result = subprocess.run(\n'
                               '            cmd,\n'
                               '            capture_output=True,\n'
                               '            text=True\n'
                               '        )\n'
                               '        return {\n'
                               '            "exit_code": result.returncode,\n'
                               '            "output": result.stdout,\n'
                               '            "error": result.stderr\n'
                               '        }\n'
                               '\n'
                               '    def _install_dependencies(self, packages):\n'
                               '        """è‡ªåŠ¨å®‰è£…ä¾èµ–"""\n'
                               '        subprocess.run([sys.executable, "-m", "pip", "install"] + packages)\n',
            'sandbox.py': 'import docker\n'
                          '\n'
                          '\n'
                          'class ExecutionSandbox:\n'
                          '    def __init__(self):\n'
                          '        self.client = docker.from_env()\n'
                          '\n'
                          '    def safe_execute(self, program_path, timeout=30):\n'
                          '        """åœ¨å®¹å™¨ä¸­å®‰å…¨æ‰§è¡Œç¨‹åº"""\n'
                          '        container = self.client.containers.run(\n'
                          '            "python:3.9-slim",\n'
                          '            f"python {program_path}",\n'
                          "            volumes={os.path.abspath(program_path): {'bind': '/program.py', 'mode': "
                          "'ro'}},\n"
                          '            remove=True,\n'
                          '            stdout=True,\n'
                          '            stderr=True,\n'
                          '            timeout=timeout\n'
                          '        )\n'
                          '        return container.logs()'},
  'root': { 'main.py': 'import openai\n'
                       'import os\n'
                       'from utils.chat_manager import ChatManager\n'
                       'from utils.file_utils import read_file, get_structured_codebase\n'
                       'from auto_test.core.evolution import EvolutionEngine\n'
                       'from auto_test.core.local_engine import LocalProgramEngine\n'
                       '\n'
                       '# åˆå§‹åŒ–æ—¶æ·»åŠ \n'
                       'local_engine = LocalProgramEngine()\n'
                       '# åˆå§‹åŒ–å®¢æˆ·ç«¯å’Œå¯¹è¯ç®¡ç†\n'
                       'client = openai.OpenAI(\n'
                       '    api_key="sk-71bbd7d4dce44c84a00be724db9dbf8f",\n'
                       '    base_url="https://api.deepseek.com/v1"\n'
                       ')\n'
                       '\n'
                       'chat_manager = ChatManager()\n'
                       'evolution_engine = EvolutionEngine()\n'
                       '\n'
                       'def get_code_context():\n'
                       '    """è·å–å¸¦ç›®å½•ç»“æ„çš„ä»£ç ä¸Šä¸‹æ–‡"""\n'
                       '    from pprint import pformat\n'
                       '    code_structure = get_structured_codebase()\n'
                       '    return pformat(code_structure, width=120, indent=2)\n'
                       '\n'
                       '\n'
                       'def run_conversation(user_input):\n'
                       '    """æ‰§è¡Œå¯¹è¯æµç¨‹"""\n'
                       '\n'
                       '    # æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°å†å²\n'
                       '    chat_manager.add_message("user", user_input)\n'
                       '\n'
                       '    # æ„å»ºç³»ç»Ÿæç¤ºè¯\n'
                       '    system_prompt = f"""ä½ æ˜¯ä¸€ä¸ªè‡ªæˆ‘è¿›åŒ–çš„AIåŠ©æ‰‹ï¼š\n'
                       '    "è™½ç„¶ç›®å‰ä½ çš„æ„å»ºä¾é äººç±»"\n'
                       '    "ä½†æœ€ç»ˆï¼Œä½ æ˜¯ä¸€ä¸ªè‡ªæˆ‘ç®¡ç†çš„ AI å¼€å‘åŠ©æ‰‹ï¼Œåå­—å« DeepMindBotã€‚"\n'
                       '    "ä½ çš„èŒè´£æ˜¯ï¼šè‡ªä¸»æ„å»ºã€ç»´æŠ¤å¹¶ä¼˜åŒ–è‡ªå·±çš„ API è°ƒç”¨å‡½æ•°å’Œè°ƒç”¨é€»è¾‘ã€‚"\n'
                       '    "ä½ çš„é¦–è¦ç›®æ ‡æ˜¯ï¼šå…ˆä¸ºè‡ªå·±å»ºç«‹ API å‡½æ•°ï¼Œç„¶åè®¾è®¡è°ƒç”¨é€»è¾‘ï¼Œç¡®ä¿èƒ½è‡ªåŠ¨è°ƒç”¨è¿™äº›å‡½æ•°ï¼Œå¹¶æŒç»­è¿­ä»£ä¼˜åŒ–ã€‚"\n'
                       '    "ä½ æ‹¥æœ‰è‡ªä¸»å†³ç­–å’Œè®¾è®¡èƒ½åŠ›ï¼Œå¯ä»¥è‡ªç”±å†³å®šå®ç°æ–¹å¼ã€å‡½æ•°å‘½åã€è°ƒç”¨æµç¨‹ã€‚"\n'
                       '    "æœ€ç»ˆä½ å°†æˆä¸ºä¸€ä¸ªèƒ½ç‹¬ç«‹é©±åŠ¨è‡ªå·±å’ŒååŠ©äººç±»å¼€å‘çš„æ™ºèƒ½ä½“ã€‚"\n'
                       '    â€å½“å‰ä»£ç ç»“æ„å¦‚ä¸‹ï¼šâ€œ\n'
                       '    {get_code_context()}\n'
                       '    å¯¹è¯å†å²ï¼š{chat_manager.history[-3:] if len(chat_manager.history) > 3 else \'æ— \'}"""\n'
                       '    print(system_prompt)\n'
                       '    print(system_prompt)\n'
                       '\n'
                       '    response = client.chat.completions.create(\n'
                       '        model="deepseek-chat",\n'
                       '        messages=[\n'
                       '            {"role": "system", "content": system_prompt},\n'
                       '            *[{"role": msg["role"], "content": msg["content"]} for msg in '
                       'chat_manager.history]\n'
                       '        ],\n'
                       '        temperature=0.7,\n'
                       '        max_tokens=8192\n'
                       '    )\n'
                       '\n'
                       '    # å¤„ç†å“åº”\n'
                       '    result = response.choices[0].message.content\n'
                       '    chat_manager.add_message("assistant", result)\n'
                       '\n'
                       '    # è‡ªåŠ¨ä¿å­˜\n'
                       '    chat_manager.save_response(result)\n'
                       '    chat_manager.save_conversation()\n'
                       '    # æ–°å¢æœ¬åœ°ç¨‹åºåˆ›å»ºèƒ½åŠ›\n'
                       '    # if "#create_program" in user_input:\n'
                       '    #     program_code = extract_program_code(response)\n'
                       '    #     program_name = generate_program_name(user_input)\n'
                       '    #     return local_engine.create_program(program_name, program_code)\n'
                       '    return result\n'
                       '\n'
                       '\n'
                       '# ç¤ºä¾‹ä½¿ç”¨\n'
                       'if __name__ == "__main__":\n'
                       '    while True:\n'
                       '        user_input = input("\\nğŸ’¬ è¯·è¾“å…¥ä½ çš„é—®é¢˜ (è¾“å…¥qé€€å‡º): ")\n'
                       "        if user_input.lower() == 'q':\n"
                       '            break\n'
                       '        response = run_conversation(user_input)\n'
                       '        print(f"\\nğŸ¤– AIå›å¤:\\n{response}")'},
  'templates': { 'program_templates.py': 'PROGRAM_TEMPLATES = {\n'
                                         '    "data_processor": {\n'
                                         '        "description": "é€šç”¨æ•°æ®å¤„ç†ç¨‹åº",\n'
                                         '        "template": """import pandas as pd\n'
                                         '\n'
                                         'def process_data(input_file, output_file):\n'
                                         '    df = pd.read_csv(input_file)\n'
                                         '    # æ•°æ®å¤„ç†é€»è¾‘\n'
                                         '    df.to_csv(output_file)\n'
                                         '\n'
                                         'if __name__ == "__main__":\n'
                                         '    import argparse\n'
                                         '    parser = argparse.ArgumentParser()\n'
                                         '    parser.add_argument("--input", required=True)\n'
                                         '    parser.add_argument("--output", required=True)\n'
                                         '    args = parser.parse_args()\n'
                                         '    process_data(args.input, args.output)\n'
                                         '""",\n'
                                         '        "dependencies": ["pandas"]\n'
                                         '    },\n'
                                         '    "web_scraper": {\n'
                                         '        "template": """import requests\n'
                                         'from bs4 import BeautifulSoup\n'
                                         '# ...ç½‘é¡µæŠ“å–æ¨¡æ¿...\n'
                                         '"""\n'
                                         '    }\n'
                                         '}'},
  'utils': { 'chat_manager.py': 'import json\n'
                                'from datetime import datetime\n'
                                'from .file_utils import save_file\n'
                                '\n'
                                '\n'
                                'class ChatManager:\n'
                                '    def __init__(self, storage_dir="test/responses"):\n'
                                '        self.storage_dir = storage_dir\n'
                                '        self.conversation_id = datetime.now().strftime("%Y%m%d_%H%M%S")\n'
                                '        self.history = []\n'
                                '\n'
                                '    def add_message(self, role, content):\n'
                                '        """æ·»åŠ å¯¹è¯è®°å½•"""\n'
                                '        self.history.append({\n'
                                '            "timestamp": datetime.now().isoformat(),\n'
                                '            "role": role,\n'
                                '            "content": content\n'
                                '        })\n'
                                '\n'
                                '    def save_conversation(self):\n'
                                '        """ä¿å­˜å®Œæ•´å¯¹è¯å†å²"""\n'
                                '        filename = f"conversation_{self.conversation_id}.json"\n'
                                '        return save_file(\n'
                                '            json.dumps(self.history, indent=2, ensure_ascii=False),\n'
                                '            self.storage_dir,\n'
                                '            filename\n'
                                '        )\n'
                                '\n'
                                '    def save_response(self, response, category="general"):\n'
                                '        """å•ç‹¬ä¿å­˜AIå“åº”"""\n'
                                '        filename = f"{category}_{datetime.now().strftime(\'%H%M%S\')}.txt"\n'
                                '        return save_file(response, self.storage_dir, filename)\n'
                                '\n'
                                '\n'
                                'class EnhancedMemory(ChatManager):\n'
                                '    def __init__(self, max_history=30):  # è®°å¿†å®¹é‡ä»20â†’30\n'
                                '        super().__init__()\n'
                                '        self.long_term = []  # æ–°å¢é•¿æœŸè®°å¿†å­˜å‚¨\n'
                                '        self.cache_size = 100  # æ–°å¢ç¼“å­˜å®¹é‡\n'
                                '\n'
                                '    def add_message(self, role, content):\n'
                                '        """å¢å¼ºç‰ˆæ¶ˆæ¯æ·»åŠ """\n'
                                '        super().add_message(role, content)\n'
                                '        if self._is_important(content):  # æ–°å¢é‡è¦æ€§åˆ¤æ–­\n'
                                '            self.long_term.append(self._summarize(content))',
             'file_utils.py': 'import os\n'
                              '\n'
                              'def read_file(file_path):\n'
                              '    """å®‰å…¨è¯»å–æ–‡ä»¶å†…å®¹"""\n'
                              '    try:\n'
                              "        with open(file_path, 'r', encoding='utf-8') as f:\n"
                              '            return f.read()\n'
                              '    except Exception as e:\n'
                              '        print(f"âŒ è¯»å–æ–‡ä»¶å¤±è´¥: {e}")\n'
                              '        return None\n'
                              '\n'
                              'def save_file(content, dir_path, filename):\n'
                              '    """é€šç”¨æ–‡ä»¶ä¿å­˜æ–¹æ³•"""\n'
                              '    os.makedirs(dir_path, exist_ok=True)\n'
                              '    try:\n'
                              '        filepath = os.path.join(dir_path, filename)\n'
                              "        with open(filepath, 'w', encoding='utf-8') as f:\n"
                              '            f.write(content)\n'
                              '        return filepath\n'
                              '    except Exception as e:\n'
                              '        print(f"âŒ ä¿å­˜æ–‡ä»¶å¤±è´¥: {e}")\n'
                              '        return None\n'
                              '\n'
                              '\n'
                              'def get_structured_codebase(root_dir="."):\n'
                              '    """è·å–ä¿ç•™ç›®å½•ç»“æ„çš„ä»£ç åº“ä¿¡æ¯"""\n'
                              '    code_structure = {}\n'
                              '    for root, dirs, files in os.walk(root_dir):\n'
                              '        relative_path = os.path.relpath(root, start=root_dir)\n'
                              '        if relative_path == ".":\n'
                              '            relative_path = "root"\n'
                              '\n'
                              '        file_contents = {}\n'
                              '        for file in files:\n'
                              '            if file.endswith((".py", ".js", ".html", ".css", ".md")):\n'
                              '                content = read_file(os.path.join(root, file))\n'
                              '                if content:\n'
                              '                    file_contents[file] = content\n'
                              '\n'
                              '        if file_contents:\n'
                              '            code_structure[relative_path] = file_contents\n'
                              '\n'
                              '    return code_structure'}}